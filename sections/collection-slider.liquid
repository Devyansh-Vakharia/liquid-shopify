<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">

{% comment %}
* Make sure you have the Flickity plugin installed and the proper license for this to function on your store
* Plugin, licensing, and documentation at https://flickity.metafizzy.co/
{% endcomment %}

{% assign collection_main = collections[section.settings.collection_main] %}
{% assign collection_limit = section.settings.collection_limit %}

{% assign cell_align = section.settings.cell_align %}
{% assign wrap_around = section.settings.wrap_around %}
{% assign img_width = section.settings.img_width | append: 'x' %}

<style>
  /* Add this CSS */
  .carousel-{{ section.id }} {
    display: flex;
    flex-wrap: nowrap; /* Ensure flex items stay in a single line */
  }

  .carousel__cell {
    flex: 0 0 auto; /* Ensure flex items do not grow or shrink */
    margin-right: 20px; /* Adjust spacing between cells as needed */
  }

  /* Optional: Adjust width of carousel to fit all cells */
  .flickity-slider {
    display: flex !important; /* Ensure slider behaves as a flex container */
  }

  /* Style for dot pagination */
  .flickity-page-dots {
    bottom: 10px;
  }

  /* Optional: Style for dot */
  .flickity-page-dots .dot {
    width: 10px;
    height: 10px;
    margin: 0 8px;
    border-radius: 50%;
    background: #ccc;
  }

  /* Optional: Active dot style */
  .flickity-page-dots .dot.is-selected {
    background: #333;
  }
</style>

<div class="flickity-section-{{ section.id }} flickity-index-slider collection" style="background-color: {{ section.settings.bg }}">
  <div class="page-width">
    <div>
      <p class="text-title text-center" style="margin-bottom:{{ section.settings.title_mb }}px">{{ section.settings.title }}</p>
    </div>
    <div class="flickity-section__carousel carousel-{{section.id }} text-center"
         data-flickity='{
           "cellAlign": "{{ cell_align }}",
           "pageDots": true, // Enable page dots
           "freeScroll": true,
           "contain": true,
           "wrapAround": {{ wrap_around }},
           "prevNextButtons": false, // Hide prev/next buttons
           "autoPlay": true // Optional: enable autoplay
         }'>

      {% for product in collection_main.products limit: collection_limit %}
        {%- if product.metafields.inventory.ShappifyHidden == 'true' -%}{%- continue -%}{%- endif -%}
        {% assign first_variant = product.selected_or_first_available_variant %}
        {% assign featured_img_src = first_variant.featured_img.src | default: product.featured_image.src %}
        {% assign price = first_variant.price %}
        {% assign compare_at_price = first_variant.compare_at_price %}
        <div class="carousel__cell">
          <a href="{{ product.url }}">
            <img src="{{ featured_img_src | img_url: img_width }}" alt="{{ product.featured_img.alt }}" />
          </a>
          <a href="{{ product.url }}">
            <h5>{{ product.title }}</h5>
          </a>
          {% if compare_at_price > price %}
            <s class="product__compare-at-price">{{ compare_at_price | money }}</s>
            <p class="product__product-price">{{ price | money }}</p>
          {% else %}
            <p class="product__product-price">{{ price | money }}</p>
          {% endif %}
        </div>
      {% endfor %}

    </div>
  </div>
</div>

<!-- Add this HTML Markup -->
<div class="carousel-dots" style="text-align: center; margin-top: 20px;"></div>

<!-- Update Flickity options -->
<script>
  $('.carousel-{{ section.id }}').flickity({
    "cellAlign": "{{ cell_align }}",
    "pageDots": true, // Enable page dots
    "freeScroll": true,
    "contain": true,
    "wrapAround": {{ wrap_around }},
    "prevNextButtons": false, // Hide prev/next buttons
    "autoPlay": true // Optional: enable autoplay
  });
</script>
